let canvas=null,ctx=null,barkPattern=null,leaves=[];const skyTop="#4272ba",skyBottom="#59b8ff",trunkColor="#817968",trunkWidth=.05,branchTipWidth=1e-4,taperAmount=1/1500,curveSharpness=5,startCurveLikelihood=.25,stopCurveLikelihood=.25,branchLikelihood=.1,minorBranchLikelihood=.2,maxBranchBend=15,minBranchBend=30,leafSize=.05,leafMissingLikelihood=.05;function randomChoice(a){return a[Math.floor(a.length*Math.random())]}function randomFloat(a,t){return Math.random()*(t-a)+a}function randomTranslatePattern(a){const t=new DOMMatrix;return t.translateSelf(120*Math.random(),120*Math.random()),a.setTransform(t),a}function drawTrunkTrap(a,t,e,n,r,o){ctx.save(),ctx.beginPath(),ctx.moveTo(a-r/2,t),ctx.lineTo(a+r/2,t),ctx.lineTo(e+o/2,n),ctx.lineTo(e-o/2,n),ctx.closePath(),ctx.fillStyle=randomTranslatePattern(barkPattern),ctx.fill(),ctx.beginPath(),ctx.moveTo(a-r/2,t),ctx.lineTo(a+r/2,t),ctx.lineTo(e+o/2,n),ctx.lineTo(e-o/2,n),ctx.closePath();const c=ctx.createLinearGradient(e-o/2,n,e+o/2,n);c.addColorStop(0,"rgba(0,0,0,0.5)"),c.addColorStop(1,"rgba(0,0,0,0)"),ctx.fillStyle=c,ctx.fill(),ctx.restore()}const initCanvas=function(){canvas=document.getElementById("canvas");const a=Math.min(window.innerWidth,window.innerHeight);canvas.width=a,canvas.height=a,ctx=canvas.getContext("2d",{alpha:!1});const t=ctx.createLinearGradient(0,0,0,canvas.height);t.addColorStop(0,skyTop),t.addColorStop(1,"#59b8ff"),ctx.fillStyle=t,ctx.fillRect(0,0,canvas.width,canvas.height);let e=!1;leaves=[];const n=["./mapleleaf1.png","./mapleleaf1-shade1.png","./mapleleaf1-shade2.png"],r="./bark2.jpg",o=n.concat([r]);let c=0;for(let a of n){let t=new Image;t.src=a,leaves.push(t),t.onload=function(){c++,c!=o.length||e||(e=!0,drawTree())}}const i=new Image;i.src=r,i.onload=function(){c++,barkPattern=ctx.createPattern(i,"repeat"),c!=o.length||e||(e=!0,drawTree())}};function drawLeaf(a){leaf=randomChoice(leaves),randomizedLeafSize=randomFloat(.75*leafSize,1.25*leafSize),Math.random()>leafMissingLikelihood&&(ctx.save(),ctx.rotate(a*Math.PI/180),ctx.translate(-1*canvas.height*randomizedLeafSize/2,-1*canvas.height*randomizedLeafSize),ctx.drawImage(leaf,0,0,leaf.naturalWidth,leaf.naturalHeight,0,0,canvas.height*randomizedLeafSize,canvas.height*randomizedLeafSize),ctx.restore())}function drawTipLeaves(){for(let a of[randomFloat(-70,-90),randomFloat(-10,10),randomFloat(70,90)])drawLeaf(a)}function drawPreTipLeaves(){for(let a of[randomFloat(-90,-110),randomFloat(90,110)])drawLeaf(a)}const drawBranch=function(a,t,e,n){const r=1e-4*canvas.width;if(e<r)return;ctx.save(),ctx.translate(a,t),ctx.rotate(n*Math.PI/180);let o=0,c=e/2,i=-1;Math.random()<.5&&(i=1);let l=!1,d=0;for(;c>r;){d++;let a=!1,t=!1;Math.random()<.1?a=!0:Math.random()<.2&&(t=!0),d>1&&drawTrunkTrap(0,o,0,o+.05*canvas.height/2,2*c,2*(c+canvas.height*taperAmount)),ctx.translate(0,o),l?(ctx.rotate(5*i*Math.PI/180),Math.random()<.25&&(l=!1,i*=-1)):Math.random()<.25&&(l=!0),ctx.beginPath(),ctx.arc(0,0,c,0,2*Math.PI),ctx.closePath(),ctx.fillStyle=randomTranslatePattern(barkPattern),ctx.fill(),ctx.beginPath(),ctx.arc(0,0,c,0,2*Math.PI),ctx.closePath();const e=ctx.createLinearGradient(0-c,0,0+c,0);e.addColorStop(0,"rgba(0,0,0,0.5)"),e.addColorStop(1,"rgba(0,0,0,0)"),ctx.fillStyle=e,ctx.fill(),o=0-.05*canvas.height/2,c-=canvas.height*taperAmount,c<r?drawTipLeaves():c-canvas.height*taperAmount<r&&drawPreTipLeaves();const n=randomChoice([-1,1]),h=randomFloat(30,15)*n,s=-1*randomFloat(30,15)*n;if(a){drawBranch(0,0,2*c,h),drawBranch(0,0,2*c,s);break}if(t){drawBranch(0,0,2*c,0),drawBranch(0,0,c*Math.random(),h);break}}ctx.restore()},drawTree=function(){drawBranch(canvas.width/2,canvas.height,.05*canvas.height,0)};function init(){initCanvas(),addEventListener("resize",(a=>{initCanvas()}))}
